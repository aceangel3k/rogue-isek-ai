# 🎮 Rogue-Isek-AI: AI-Powered Dungeon Crawler

**An LLM-powered procedurally generated Wolfenstein 3D-style raycaster game where AI creates everything.**

[![React](https://img.shields.io/badge/React-19.1-blue.svg)](https://reactjs.org/)
[![Flask](https://img.shields.io/badge/Flask-3.0-green.svg)](https://flask.palletsprojects.com/)
[![Python](https://img.shields.io/badge/Python-3.10+-yellow.svg)](https://www.python.org/)
[![Tailwind CSS](https://img.shields.io/badge/Tailwind-4.1-38bdf8.svg)](https://tailwindcss.com/)

---

## 🌟 Overview

**Rogue-Isek-AI** is a first-person dungeon crawler where **every element** - story, textures, enemies, dialogue, and world layout - is dynamically generated by AI based on a single player prompt.

### Key Features

- 🤖 **100% AI-Generated Content** - Story, textures, sprites, and dialogue created by LLMs
- 🎨 **Dynamic Asset Generation** - Unique visuals for every dungeon using Gemini/GPT image models
- 🏰 **Procedural Dungeons** - BSP algorithm generates unique layouts
- 🔫 **Fast-Paced FPS Combat** - Classic Wolfenstein 3D-style raycasting
- 🌍 **Shared World System** - Play through other players' dungeon creations
- 📖 **AI Story Patching** - Seamless narrative bridges between different worlds
- 💾 **Campaign Progression** - Save/load system with persistent inventory

---

## 🎯 How It Works

```
1. Player enters prompt → "A cyberpunk tower with rogue AI"
2. LLM generates story, rules, enemies, items (Cerebras Llama-3.3-70b)
3. AI creates wall textures matching theme (Gemini 2.5 Flash / GPT-Image-1)
4. Procedural dungeon generation (BSP algorithm)
5. Player spawns and explores in first-person 3D
6. Complete level → Load another player's dungeon
7. AI patches stories together seamlessly
```

---

## 🚀 Quick Start

### Prerequisites

- **Node.js** v18+ and npm
- **Python** 3.10+
- **API Keys** for:
  - [Cerebras](https://inference.cerebras.ai/) (text generation)
  - [OpenAI](https://platform.openai.com/api-keys) (image generation)
  - [Google Gemini](https://aistudio.google.com/apikey) (image generation)

### Installation

#### 1. Clone the Repository

```bash
git clone <repository-url>
cd rogue-isek-ai
```

#### 2. Backend Setup

```bash
cd backend

# Create virtual environment
python3 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt

# Create .env file
cat > .env << EOF
CEREBRAS_API_KEY=your_cerebras_key_here
OPENAI_API_KEY=your_openai_key_here
GEMINI_API_KEY=your_gemini_key_here
SECRET_KEY=your_random_secret_key
EOF

# Initialize database
python -c "from database import init_database; init_database()"

# Run backend server
python app.py
```

Backend will run on `http://localhost:5001`

#### 3. Frontend Setup

```bash
cd ../frontend

# Install dependencies
npm install

# Run development server
npm run dev
```

Frontend will run on `http://localhost:5173`

---

## 🎮 Usage

1. **Open your browser** to `http://localhost:5173`
2. **Enter a prompt** describing your desired dungeon:
   - *"A haunted castle ruled by an undead king"*
   - *"A space station overrun by alien parasites"*
   - *"A megacorp tower controlled by rogue AI"*
3. **Wait for AI generation** (~10-30 seconds)
4. **Play the game**:
   - **WASD** or **Arrow Keys** - Move
   - **Mouse** - Look around
   - **Left Click** - Shoot
   - **E** - Interact with NPCs/doors
   - **ESC** - Pause menu
5. **Complete the dungeon** and continue to another player's creation!

---

## 🏗️ Architecture

### Tech Stack

**Frontend:**
- React 19 + Vite
- Tailwind CSS 4
- Canvas API (raycasting renderer)
- Three.js (texture utilities)

**Backend:**
- Flask (Python web framework)
- LiteLLM (unified LLM interface)
- Google GenAI SDK (image generation)
- SQLite (game state persistence)

**AI Services:**
- **Cerebras Llama-3.3-70b** - Story, dialogue, narrative patching
- **Gemini 2.5 Flash Image Preview** - Primary texture/sprite generation (1-30s)
- **GPT-Image-1** - Fallback image generation (1-3min)

### Project Structure

```
rogue-isek-ai/
├── backend/
│   ├── app.py                 # Flask application entry point
│   ├── database.py            # SQLite database operations
│   ├── schema.sql             # Database schema
│   ├── requirements.txt       # Python dependencies
│   ├── routes/                # API route handlers
│   │   ├── game.py           # Game generation endpoint
│   │   ├── textures.py       # Texture generation
│   │   ├── sprites.py        # Sprite generation
│   │   ├── npc.py            # NPC dialogue
│   │   ├── saves.py          # Save/load system
│   │   └── shared.py         # Shared world system
│   ├── services/              # AI service integrations
│   │   ├── llm_service.py    # LLM text generation
│   │   └── image_service.py  # Image generation
│   └── utils/                 # Utility functions
│
└── frontend/
    ├── src/
    │   ├── App.jsx           # Main React component
    │   ├── components/       # React components
    │   │   ├── GameSetup.jsx        # Initial prompt screen
    │   │   ├── LoadingScreen.jsx    # AI generation progress
    │   │   ├── SimpleRaycaster.jsx  # 3D raycasting engine
    │   │   ├── GameManager.jsx      # Game state management
    │   │   ├── HUD.jsx              # Health/ammo/gold display
    │   │   ├── ShopInterface.jsx    # NPC shop system
    │   │   └── StoryTransition.jsx  # Level transitions
    │   ├── engine/           # Game engine modules
    │   │   ├── raycaster.js         # Raycasting algorithm
    │   │   ├── player.js            # Player controller
    │   │   ├── enemy.js             # Enemy AI
    │   │   └── dungeon.js           # Dungeon generation
    │   └── utils/            # Utility functions
    ├── package.json
    └── vite.config.js

```

---

## 🎨 Core Systems

### 1. AI Generation Pipeline

- **Story Generation**: Cerebras Llama-3.3-70b creates narrative, enemies, items
- **Texture Generation**: Gemini/GPT creates 512x512 seamless wall textures
- **Sprite Generation**: AI generates enemy and NPC sprites
- **Dialogue System**: Real-time LLM responses for NPC interactions

### 2. Raycasting Engine

- **Algorithm**: DDA (Digital Differential Analysis) raycasting
- **Resolution**: 800x600 canvas
- **Performance**: 60 FPS on MacBook Air M1
- **Features**: Texture-mapped walls, sprite rendering, collision detection

### 3. Procedural Dungeon Generation

- **Algorithm**: BSP (Binary Space Partitioning)
- **Sizes**: Small (16x16), Medium (24x24), Large (32x32)
- **Elements**: Rooms, corridors, spawn points, exit portals
- **Tile Types**: Walls, doors, NPCs, enemies, items, exit

### 4. Shared World System

- **Dungeon Sharing**: Completed dungeons saved to database
- **Matchmaking**: System selects next dungeon from player pool
- **Story Patching**: AI generates narrative bridges between worlds
- **Seamless Transitions**: Inventory and progress carry over

---

## 📡 API Endpoints

### Game Generation
```
POST /api/generate-game
Body: { "user_prompt": "string", "player_id": "string" }
Returns: Complete game data (story, enemies, items, dungeon)
```

### Texture Generation
```
POST /api/generate-textures
Body: { "theme": "string", "count": number }
Returns: Array of base64-encoded texture images
```

### NPC Dialogue
```
POST /api/generate-npc-dialogue
Body: { "npc_id": "string", "player_message": "string", "context": {} }
Returns: { "response": "string" }
```

### Save/Load
```
POST /api/save-game
Body: { "player_id": "string", "game_data": {} }

GET /api/load-game?player_id=string
Returns: Saved game state
```

### Shared World
```
GET /api/get-next-dungeon?player_id=string&exclude_ids=[]
Returns: Another player's dungeon

POST /api/patch-story
Body: { "previous_story": {}, "next_story": {} }
Returns: { "transition_narrative": "string" }
```

---

## 🎯 Example Prompts

Try these prompts to test the game:

1. **Fantasy**: *"A haunted castle ruled by an undead king"*
2. **Sci-Fi**: *"A space station overrun by alien parasites"*
3. **Cyberpunk**: *"A megacorp tower controlled by rogue AI"*
4. **Horror**: *"An abandoned asylum where experiments went wrong"*
5. **Post-Apocalyptic**: *"A frozen wasteland with mutated creatures"*
6. **Steampunk**: *"A clockwork factory with rogue automatons"*
7. **Lovecraftian**: *"An underwater temple to an ancient god"*

---

## 🔧 Configuration

### Backend Environment Variables

Create `backend/.env`:

```bash
# Required API Keys
CEREBRAS_API_KEY=your_cerebras_api_key
OPENAI_API_KEY=your_openai_api_key
GEMINI_API_KEY=your_gemini_api_key

# Flask Configuration
SECRET_KEY=your_random_secret_key_here
FLASK_ENV=development

# Optional: Model Configuration
TEXT_MODEL=llama-3.3-70b
IMAGE_MODEL_PRIMARY=gemini-2.5-flash-image-preview
IMAGE_MODEL_FALLBACK=gpt-image-1
```

### Frontend Configuration

Edit `frontend/src/config.js` (if needed):

```javascript
export const API_BASE_URL = 'http://localhost:5001/api';
export const RENDER_WIDTH = 800;
export const RENDER_HEIGHT = 600;
export const FOV = 60;
export const MOVEMENT_SPEED = 0.1;
```

---

## 🧪 Testing

### Backend Tests

```bash
cd backend

# Test LLM connection
python test_llm.py

# Test story generation
python test_story_generation.py

# Test texture generation
python test_texture_generation.py

# Test sprite generation
python test_sprites.py
```

### Frontend Tests

```bash
cd frontend

# Run sprite test component
npm run test-sprites

# Build for production
npm run build

# Preview production build
npm run preview
```

---

## 🚀 Deployment

### Backend Deployment (Private macOS Server)

1. **Install dependencies**:
```bash
pip install gunicorn
```

2. **Create systemd/launchd service** (macOS):
```xml
<!-- ~/Library/LaunchAgents/com.rogueisekai.backend.plist -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.rogueisekai.backend</string>
    <key>ProgramArguments</key>
    <array>
        <string>/path/to/venv/bin/gunicorn</string>
        <string>-w</string>
        <string>4</string>
        <string>-b</string>
        <string>127.0.0.1:5001</string>
        <string>app:app</string>
    </array>
    <key>WorkingDirectory</key>
    <string>/path/to/rogue-isek-ai/backend</string>
    <key>RunAtLoad</key>
    <true/>
    <key>KeepAlive</key>
    <true/>
</dict>
</plist>
```

3. **Load service**:
```bash
launchctl load ~/Library/LaunchAgents/com.rogueisekai.backend.plist
```

### Frontend Deployment

```bash
cd frontend
npm run build

# Serve with nginx or copy dist/ to web server
```

---

## 🐛 Troubleshooting

### Common Issues

**Backend won't start:**
- Check API keys in `.env` file
- Verify Python virtual environment is activated
- Ensure port 5001 is not in use

**Frontend can't connect to backend:**
- Verify backend is running on `http://localhost:5001`
- Check CORS settings in `backend/app.py`
- Clear browser cache and reload

**AI generation is slow:**
- Gemini image generation: 1-30 seconds (normal)
- GPT-Image-1 fallback: 1-3 minutes (normal)
- Check API rate limits and quotas

**Textures not loading:**
- Check browser console for errors
- Verify image generation completed successfully
- Check localStorage for cached textures

**Game performance issues:**
- Reduce render resolution in config
- Close other browser tabs
- Check for console errors

---

## 🤝 Contributing

This project was developed as a 3-day sprint. Contributions are welcome!

### Development Guidelines

1. **Code Style**: Follow existing patterns
2. **Comments**: Document complex algorithms
3. **Testing**: Test changes before committing
4. **Commits**: Use descriptive commit messages

### Areas for Enhancement

- [ ] GPU shader raycaster (10-100x performance boost)
- [ ] Advanced lighting (spotlights, point lights, emissive surfaces)
- [ ] Floor and ceiling textures
- [ ] Multiple enemy types with unique behaviors
- [ ] Advanced weapon system
- [ ] Procedural music generation
- [ ] Mobile support
- [ ] Multiplayer spectating

---

## 📄 License

**Attribution License (CC BY 4.0)**

Copyright (c) 2025 Rogue-Isek-AI

This work is licensed under the Creative Commons Attribution 4.0 International License.

### You are free to:

- **Share** — copy and redistribute the material in any medium or format
- **Adapt** — remix, transform, and build upon the material for any purpose, even commercially

### Under the following terms:

- **Attribution** — You must give appropriate credit, provide a link to the license, and indicate if changes were made. You may do so in any reasonable manner, but not in any way that suggests the licensor endorses you or your use.

**No additional restrictions** — You may not apply legal terms or technological measures that legally restrict others from doing anything the license permits.

For the full license text, visit: https://creativecommons.org/licenses/by/4.0/

**Note**: AI Services require API keys and may incur costs. All textures and sprites are AI-generated at runtime.

---

## 🙏 Acknowledgments

- **Raycasting Engine**: Inspired by Wolfenstein 3D and Lode's raycasting tutorial
- **AI Services**: Cerebras, OpenAI, Google Gemini
- **Reference Implementation**: Based on wofl3d raycaster project

---

## 📞 Support

For issues, questions, or feature requests:
- Review the troubleshooting section above
- Open an issue on the repository

---

## 🎮 Have Fun!

Enter a prompt, explore AI-generated dungeons, and experience infinite procedural adventures!
